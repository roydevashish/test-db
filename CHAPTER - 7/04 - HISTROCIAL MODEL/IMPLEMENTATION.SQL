DROP TABLE DB_AUDIT.DRUG_COMPANY;
CREATE TABLE DB_AUDIT.DRUG_COMPANY (
    DRUG_COMPANY_ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    DRUG_COMPANY_NAME VARCHAR2(4000) NOT NULL,
    PHONE NUMBER(10) NOT NULL
)

DROP TABLE DB_AUDIT.DRUG_COMPANY_HISTORY;
CREATE TABLE DB_AUDIT.DRUG_COMPANY_HISTORY (
    HISTORY_ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    DRUG_COMPANY_ID NUMBER,
    DRUG_COMPANY_NAME VARCHAR2(4000) NOT NULL,
    PHONE NUMBER(10) NOT NULL
)

DROP TRIGGER DB_AUDIT.AUDIT_DRUG_COMPANY;

CREATE OR REPLACE TRIGGER DB_AUDIT.AUDIT_DRUG_COMPANY
BEFORE UPDATE OR DELETE ON DB_AUDIT.DRUG_COMPANY
FOR EACH ROW
BEGIN
    INSERT INTO DB_AUDIT.DRUG_COMPANY_HISTORY(DRUG_COMPANY_ID, DRUG_COMPANY_NAME, PHONE)
    VALUES(:OLD.DRUG_COMPANY_ID, :OLD.DRUG_COMPANY_NAME, :OLD.PHONE);
END;

-- INSERT SOME VALUES
INSERT INTO DB_AUDIT.DRUG_COMPANY (DRUG_COMPANY_NAME, PHONE)
VALUES('Dr. Reddy''s Laboratories.', '1234567890');

INSERT INTO DB_AUDIT.DRUG_COMPANY (DRUG_COMPANY_NAME, PHONE)
VALUES('Aurobindo Pharma', '2345678901');

INSERT INTO DB_AUDIT.DRUG_COMPANY (DRUG_COMPANY_NAME, PHONE)
VALUES('Lupin', '3456789012');

INSERT INTO DRUG_COMPANY (DRUG_COMPANY_NAME, PHONE)
VALUES('Biocon', '4567890123');

INSERT INTO DB_AUDIT.DRUG_COMPANY (DRUG_COMPANY_NAME, PHONE)
VALUES('Mankind Pharma', '5678901234');

-- VIEW THE INSERTED VALUES
SELECT * FROM DB_AUDIT.DRUG_COMPANY;

-- UPDATE ONE RECORD
UPDATE DB_AUDIT.DRUG_COMPANY
SET DRUG_COMPANY_NAME = 'New Dr. Reddy''s Laboratories.'
WHERE DRUG_COMPANY_ID = 1;

-- DELETE ONE RECORD
DELETE FROM DB_AUDIT.DRUG_COMPANY
WHERE DRUG_COMPANY_ID = 5;

-- VIEW THE HISTORY RECORED
SELECT * FROM DB_AUDIT.DRUG_COMPANY_HISTORY;